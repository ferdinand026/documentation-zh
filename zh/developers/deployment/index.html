
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.8">
    
    
      
        <title>部署文档 - Java Tron</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.8608ea7d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../" title="Java Tron" class="md-header__button md-logo" aria-label="Java Tron" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Java Tron
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              部署文档
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="选择当前语言">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="./" hreflang="zh" class="md-select__link">
              简体中文
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../../en/zh/developers/deployment/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../" class="md-tabs__link">
          
  
  简体中文

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../index.md" class="md-tabs__link">
          
  
  English

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../" title="Java Tron" class="md-nav__button md-logo" aria-label="Java Tron" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Java Tron
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    简体中文
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            简体中文
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    主页
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    English
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            English
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting Started With java-tron
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started With java-tron
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting_started/getting_started_with_javatron.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Using java-tron
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Using java-tron
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../using_javatron/installing_javatron.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deploying
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../using_javatron/backup_restore.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Backup and Restore
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../using_javatron/litefullnode.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lite FullNode
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../using_javatron/private_network.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Private Network
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../architecture/event.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Event Subscription
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../architecture/database.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Database Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../using_javatron/connecting_to_tron.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Network Connection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../using_javatron/metrics.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Node Monitoring
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../using_javatron/toolkit.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Node Maintenance Tool
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/http.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTTP API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/rpc.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    gRPC API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/json-rpc.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    jsonRPC API
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Core Protocol
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            Core Protocol
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mechanism-algorithm/dpos.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DPoS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mechanism-algorithm/sr.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Super Representative
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mechanism-algorithm/account.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Account Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mechanism-algorithm/resource.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Resource Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../contracts/contract.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Smart Contract
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mechanism-algorithm/system-contracts.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    System Contract
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mechanism-algorithm/dex.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Decentralized Exchange
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mechanism-algorithm/multi-signatures.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Account Permission Management
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    For java-tron Developers
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            For java-tron Developers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developers/java-tron.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Developer Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developers/tips.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TIPs Workflow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developers/issue-workflow.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Issue Workflow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developers/governance.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Governance Workflow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developers/run-in-idea.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configure the IDE
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developers/demo.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Development Example
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developers/code-structure.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Core Modules
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_7" >
        
          
          <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    For Dapp Developers
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            For Dapp Developers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../contracts/tools.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tools
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_8" >
        
          
          <label class="md-nav__link" for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Clients
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_8">
            <span class="md-nav__icon md-icon"></span>
            Clients
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../clients/wallet-cli.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    wallet-cli
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_9" >
        
          
          <label class="md-nav__link" for="__nav_2_9" id="__nav_2_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Releases
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_9">
            <span class="md-nav__icon md-icon"></span>
            Releases
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../releases/upgrade-instruction.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deployment Manual for the New Version
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../releases/signature_verification.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integrity Check
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../releases/history.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    History
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_10" >
        
          
          <label class="md-nav__link" for="__nav_2_10" id="__nav_2_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Appendix
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_10">
            <span class="md-nav__icon md-icon"></span>
            Appendix
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../glossary.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Glossary
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      前提
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      部署指南
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      日志与网络连接验证
    </span>
  </a>
  
    <nav class="md-nav" aria-label="日志与网络连接验证">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fullnode" class="md-nav__link">
    <span class="md-ellipsis">
      FullNode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#soliditynode" class="md-nav__link">
    <span class="md-ellipsis">
      SolidityNode
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      优雅的停止节点
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      快速部署节点
    </span>
  </a>
  
    <nav class="md-nav" aria-label="快速部署节点">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      使用范围
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      下载运行脚本
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      参数含义
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fullnode_1" class="md-nav__link">
    <span class="md-ellipsis">
      部署FullNode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#soliditynode_1" class="md-nav__link">
    <span class="md-ellipsis">
      部署SolidityNode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fullnodesoliditynode" class="md-nav__link">
    <span class="md-ellipsis">
      FullNode和SolidityNode部署在同一主机上
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#grpc-gateway" class="md-nav__link">
    <span class="md-ellipsis">
      Grpc Gateway部署
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Grpc Gateway部署">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      前提
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      下载运行脚本
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      参数含义
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      示例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      事件订阅部署
    </span>
  </a>
  
    <nav class="md-nav" aria-label="事件订阅部署">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      搭建运行环境
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#java-tron-configconf" class="md-nav__link">
    <span class="md-ellipsis">
      编辑java-tron的 config.conf 文件，增加以下字段
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kafka" class="md-nav__link">
    <span class="md-ellipsis">
      安装Kafka
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kafka_1" class="md-nav__link">
    <span class="md-ellipsis">
      运行Kafka
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configconf" class="md-nav__link">
    <span class="md-ellipsis">
      创建主题接受事件，主题的定义位于config.conf文件中
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kafka_2" class="md-nav__link">
    <span class="md-ellipsis">
      Kafka用户
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#java-tron" class="md-nav__link">
    <span class="md-ellipsis">
      在java-tron中加载插件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      事件订阅过滤
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mongodb" class="md-nav__link">
    <span class="md-ellipsis">
      下载并安装MongoDB
    </span>
  </a>
  
    <nav class="md-nav" aria-label="下载并安装MongoDB">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      建议配置
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      设计环境变量
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      创建配置文件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      示例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      注意
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mongodb_1" class="md-nav__link">
    <span class="md-ellipsis">
      运行MongoDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      创建管理员账户
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      创建事件日志以及所有者账户
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      防火墙策略
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mongo" class="md-nav__link">
    <span class="md-ellipsis">
      远程连接mongo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      查询区块事件触发数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      设置数据库索引
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      事件订阅数据查询服务部署
    </span>
  </a>
  
    <nav class="md-nav" aria-label="事件订阅数据查询服务部署">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      下载代码
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      编译
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      运行
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      高级配置
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="_1">部署文档<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<h2 id="_2">前提<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>分别为fullnode和soliditynode创建一个目录</p>
<blockquote>
<p>NOTE: 原则上不鼓励继续使用 SolidityNode, 目前 FullNode 可以替代 SolidityNode 的功能.</p>
</blockquote>
<div class="codehilite"><pre><span></span><code>/deploy/fullnode
/deploy/soliditynode
</code></pre></div>

<p>克隆最新的master分支上的代码<a href="https://github.com/tronprotocol/java-tron">https://github.com/tronprotocol/java-tron</a> 到</p>
<div class="codehilite"><pre><span></span><code>/deploy/java-tron
</code></pre></div>

<p>请确保已经安装恰当的依赖环境。</p>
<ul>
<li>JDK 1.8 (JDK 1.9+ is not supported yet)</li>
<li>On Linux Ubuntu system (e.g. Ubuntu 16.04.4 LTS), ensure that the machine has <a href="https://www.digitalocean.com/community/tutorials/how-to-install-java-with-apt-get-on-ubuntu-16-04"><strong>Oracle JDK 8</strong></a>, instead of having <strong>Open JDK 8</strong> in the system. If you are building the source code by using <strong>Open JDK 8</strong>, you will get <a href="https://github.com/tronprotocol/java-tron/issues/337"><strong>Build Failed</strong></a> result.</li>
<li>Open <strong>UDP</strong> ports for connection to the network</li>
<li><strong>MINIMUM</strong> 2 CPU Cores</li>
</ul>
<h2 id="_3">部署指南<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<ol>
<li>编译java-tron项目</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/deploy/java-tron
./gradlew<span class="w"> </span>build
</code></pre></div>

<ol>
<li>复制FullNode.jar和SolidityNode.jar以及相应的配置文件到各自的目录</li>
</ol>
<div class="codehilite"><pre><span></span><code>download<span class="w"> </span>your<span class="w"> </span>needed<span class="w"> </span>configuration<span class="w"> </span>file<span class="w"> </span>from<span class="w"> </span>https://github.com/tronprotocol/TronDeployment.

main_net_config.conf<span class="w"> </span>is<span class="w"> </span>the<span class="w"> </span>configuration<span class="w"> </span><span class="k">for</span><span class="w"> </span>MainNet,<span class="w"> </span>and<span class="w"> </span>test_net_config.conf<span class="w"> </span>is<span class="w"> </span>the<span class="w"> </span>configuration<span class="w"> </span><span class="k">for</span><span class="w"> </span>TestNet.

please<span class="w"> </span>rename<span class="w"> </span>the<span class="w"> </span>configuration<span class="w"> </span>file<span class="w"> </span>to<span class="w"> </span><span class="sb">`</span>config.conf<span class="sb">`</span><span class="w"> </span>and<span class="w"> </span>use<span class="w"> </span>this<span class="w"> </span>config.conf<span class="w"> </span>to<span class="w"> </span>start<span class="w"> </span>FullNode<span class="w"> </span>and<span class="w"> </span>SoliditNode.

cp<span class="w"> </span>build/libs/FullNode.jar<span class="w"> </span>../fullnode

cp<span class="w"> </span>build/libs/SolidityNode.jar<span class="w"> </span>../soliditynode
</code></pre></div>

<ol>
<li>用以下命令运行FullNode</li>
</ol>
<div class="codehilite"><pre><span></span><code>java<span class="w"> </span>-jar<span class="w"> </span>FullNode.jar<span class="w"> </span>-c<span class="w"> </span>config.conf<span class="w"> </span>//<span class="w"> </span>make<span class="w"> </span>sure<span class="w"> </span>that<span class="w"> </span>your<span class="w"> </span>config.conf<span class="w"> </span>is<span class="w"> </span>downloaded<span class="w"> </span>from<span class="w"> </span>https://github.com/tronprotocol/TronDeployment
</code></pre></div>

<ol>
<li>配置SolidityNode配置文件</li>
</ol>
<p>需要编辑<code>config.conf</code>文件来连接本地的FullNode。修改<code>node</code>里的<code>trustNode</code>为<code>127.0.0.1:50051</code>，这是默认rpc端口。设置<code>listen.port</code>为1024-65535间任意数字。不要使用0-1024间的数字，因为可能会导致与系统服务冲突。同样，为了避免冲突，可以把<code>rpc port</code>改为<code>50052</code>。</p>
<p><strong>请为FullNode转发UDP端口18888</strong></p>
<div class="codehilite"><pre><span></span><code>rpc {
      port = 50052
    }
</code></pre></div>

<ol>
<li>用以下命令运行SolidityNode</li>
</ol>
<div class="codehilite"><pre><span></span><code>java<span class="w"> </span>-jar<span class="w"> </span>SolidityNode.jar<span class="w"> </span>-c<span class="w"> </span>config.conf<span class="w"> </span>//make<span class="w"> </span>sure<span class="w"> </span>that<span class="w"> </span>your<span class="w"> </span>config.conf<span class="w"> </span>is<span class="w"> </span>downloaded<span class="w"> </span>from<span class="w"> </span>https://github.com/tronprotocol/TronDeployment
</code></pre></div>

<ol>
<li>在公链环境中运行超级节点</li>
</ol>
<div class="codehilite"><pre><span></span><code>java<span class="w"> </span>-jar<span class="w"> </span>FullNode.jar<span class="w"> </span>-p<span class="w"> </span>your<span class="w"> </span>private<span class="w"> </span>key<span class="w"> </span>--witness<span class="w"> </span>-c<span class="w"> </span>your<span class="w"> </span>config.conf<span class="o">(</span>Example：/data/java-tron/config.conf<span class="o">)</span>
Example:
java<span class="w"> </span>-jar<span class="w"> </span>FullNode.jar<span class="w"> </span>-p<span class="w"> </span>650950B193DDDDB35B6E48912DD28F7AB0E7140C1BFDEFD493348F02295BD812<span class="w"> </span>--witness<span class="w"> </span>-c<span class="w"> </span>/data/java-tron/config.conf
</code></pre></div>

<p>这与运行一个个人测试网相似，除了<code>config.conf</code>中的IP不一样。</p>
<ol>
<li>在个人测试网环境中运行超级节点</li>
</ol>
<p>你需要修改一下config.conf配置文件内容：</p>
<ul>
<li>Replace existing entry in genesis.block.witnesses with your address</li>
<li>Replace existing entry in seed.node ip.list with your ip list</li>
<li>The first Super Node start, needSyncCheck should be set false</li>
<li>Set p2p version to 61</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>build/libs
java<span class="w"> </span>-jar<span class="w"> </span>FullNode.jar<span class="w"> </span>-p<span class="w"> </span>your<span class="w"> </span>private<span class="w"> </span>key<span class="w"> </span>--witness<span class="w"> </span>-c<span class="w"> </span>your<span class="w"> </span>config.conf<span class="w"> </span><span class="o">(</span>Example：/data/java-tron/config.conf<span class="o">)</span>
Example:
java<span class="w"> </span>-jar<span class="w"> </span>FullNode.jar<span class="w"> </span>-p<span class="w"> </span>650950B193DDDDB35B6E48912DD28F7AB0E7140C1BFDEFD493348F02295BD812<span class="w"> </span>--witness<span class="w"> </span>-c<span class="w"> </span>/data/java-tron/config.conf
</code></pre></div>

<h2 id="_4">日志与网络连接验证<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p>日志位于<code>/deploy/\*/logs/tron.log</code>。 使用<code>tail -f /logs/tron.log/</code>命令来查看块同步日志。</p>
<p>你可以看到类似如下块同步的日志信息：</p>
<h3 id="fullnode">FullNode<a class="headerlink" href="#fullnode" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="mi">12</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mf">57.658</span><span class="w"> </span><span class="n">INFO</span><span class="w">  </span><span class="o">[</span><span class="n">pool</span><span class="o">-</span><span class="mi">7</span><span class="o">-</span><span class="n">thread</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">o</span><span class="o">.</span><span class="na">t</span><span class="o">.</span><span class="na">c</span><span class="o">.</span><span class="na">n</span><span class="o">.</span><span class="na">n</span><span class="o">.</span><span class="na">NodeImpl</span><span class="o">](</span><span class="n">NodeImpl</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">830</span><span class="o">)</span><span class="w"> </span><span class="n">Success</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="n">Num</span><span class="o">:</span><span class="mi">236610</span><span class="o">,</span><span class="n">ID</span><span class="o">:</span><span class="mi">0000000000039</span><span class="n">c427569efa27cc2493c1fff243cc1515aa6665c617c45d2e1bf</span>
</code></pre></div>

<h3 id="soliditynode">SolidityNode<a class="headerlink" href="#soliditynode" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="mi">12</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mf">40.691</span><span class="w"> </span><span class="n">INFO</span><span class="w">  </span><span class="o">[</span><span class="n">pool</span><span class="o">-</span><span class="mi">17</span><span class="o">-</span><span class="n">thread</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">o</span><span class="o">.</span><span class="na">t</span><span class="o">.</span><span class="na">p</span><span class="o">.</span><span class="na">SolidityNode</span><span class="o">](</span><span class="n">SolidityNode</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">88</span><span class="o">)</span><span class="w"> </span><span class="n">sync</span><span class="w"> </span><span class="n">solidity</span><span class="w"> </span><span class="n">block</span><span class="o">,</span><span class="w"> </span><span class="n">lastSolidityBlockNum</span><span class="o">:</span><span class="mi">209671</span><span class="o">,</span><span class="w"> </span><span class="n">remoteLastSolidityBlockNum</span><span class="o">:</span><span class="mi">211823</span>
</code></pre></div>

<h2 id="_5">优雅的停止节点<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h2>
<p>创建stop.sh文件，使用命令<code>kill -15</code>关闭FullNode.jar（或者SolidityNode.jar）。
修改pid=<code>ps -ef |grep FullNode.jar |grep -v grep |awk '{print $2}'</code>来找到正确的pid。</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="k">while</span><span class="w"> </span>true<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span><span class="nv">pid</span><span class="o">=</span><span class="sb">`</span>ps<span class="w"> </span>-ef<span class="w"> </span><span class="p">|</span>grep<span class="w"> </span>FullNode.jar<span class="w"> </span><span class="p">|</span>grep<span class="w"> </span>-v<span class="w"> </span>grep<span class="w"> </span><span class="p">|</span>awk<span class="w"> </span><span class="s1">&#39;{print $2}&#39;</span><span class="sb">`</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$pid</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">kill</span><span class="w"> </span>-15<span class="w"> </span><span class="nv">$pid</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;The java-tron process is exiting, it may take some time, forcing the exit may cause damage to the database, please wait patiently...&quot;</span>
<span class="w">    </span>sleep<span class="w"> </span><span class="m">1</span>
<span class="w">  </span><span class="k">else</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;java-tron killed successfully!&quot;</span>
<span class="w">    </span><span class="k">break</span>
<span class="w">  </span><span class="k">fi</span>
<span class="k">done</span>
</code></pre></div>

<h2 id="_6">快速部署节点<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h2>
<p>下载快速部署脚本，根据部署节点类型，执行脚本。</p>
<h3 id="_7">使用范围<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p>脚本可以再Linux/MacOS上使用，不支持Windows系统。
只支持FullNode与SolidityNode的部署。</p>
<h3 id="_8">下载运行脚本<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>wget<span class="w"> </span>https://raw.githubusercontent.com/tronprotocol/TronDeployment/master/deploy_tron.sh<span class="w"> </span>-O<span class="w"> </span>deploy_tron.sh
</code></pre></div>

<h3 id="_9">参数含义<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>bash<span class="w"> </span>deploy_tron.sh<span class="w"> </span>--app<span class="w"> </span><span class="o">[</span>FullNode<span class="p">|</span>SolidityNode<span class="o">]</span><span class="w"> </span>--net<span class="w"> </span><span class="o">[</span>mainnet<span class="p">|</span>testnet<span class="p">|</span>privatenet<span class="o">]</span><span class="w"> </span>--db<span class="w"> </span><span class="o">[</span>keep<span class="p">|</span>remove<span class="p">|</span>backup<span class="o">]</span><span class="w"> </span>--heap-size<span class="w"> </span>&lt;heapsize&gt;

--app<span class="w"> </span>Optional,<span class="w"> </span>Running<span class="w"> </span>application.<span class="w"> </span>The<span class="w"> </span>default<span class="w"> </span>node<span class="w"> </span>is<span class="w"> </span>Fullnode<span class="w"> </span>and<span class="w"> </span>it<span class="w"> </span>could<span class="w"> </span>be<span class="w"> </span>FullNode<span class="w"> </span>or<span class="w"> </span>SolidityNode.
--net<span class="w"> </span>Optional,<span class="w"> </span>Connecting<span class="w"> </span>network.<span class="w"> </span>The<span class="w"> </span>default<span class="w"> </span>network<span class="w"> </span>is<span class="w"> </span>mainnet<span class="w"> </span>and<span class="w"> </span>it<span class="w"> </span>could<span class="w"> </span>be<span class="w"> </span>mainnet,<span class="w"> </span>testnet.
--db<span class="w">  </span>Optional,<span class="w"> </span>The<span class="w"> </span>way<span class="w"> </span>of<span class="w"> </span>data<span class="w"> </span>processing<span class="w"> </span>could<span class="w"> </span>be<span class="w"> </span>keep,<span class="w"> </span>remove<span class="w"> </span>and<span class="w"> </span>backup.<span class="w"> </span>Default<span class="w"> </span>is<span class="w"> </span>keep.<span class="w"> </span>If<span class="w"> </span>you<span class="w"> </span>launch<span class="w"> </span>two<span class="w"> </span>different<span class="w"> </span>networks,<span class="w"> </span>like<span class="w"> </span>from<span class="w"> </span>mainnet<span class="w"> </span>to<span class="w"> </span>testnet<span class="w"> </span>or<span class="w"> </span>from<span class="w"> </span>testnet<span class="w"> </span>to<span class="w"> </span>mainnet,<span class="w"> </span>you<span class="w"> </span>need<span class="w"> </span>to<span class="w"> </span>delete<span class="w"> </span>database.
--trust-node<span class="w">  </span>Optional,<span class="w"> </span>It<span class="w"> </span>only<span class="w"> </span>works<span class="w"> </span>when<span class="w"> </span>deploying<span class="w"> </span>SolidityNode.<span class="w"> </span>Default<span class="w"> </span>is<span class="w"> </span><span class="m">127</span>.0.0.1:50051.<span class="w"> </span>The<span class="w"> </span>specified<span class="w"> </span>gRPC<span class="w"> </span>service<span class="w"> </span>of<span class="w"> </span>Fullnode,<span class="w"> </span>like<span class="w"> </span><span class="m">127</span>.0.0.1:50051<span class="w"> </span>or<span class="w"> </span><span class="m">13</span>.125.249.129:50051.
--rpc-port<span class="w">  </span>Optional,<span class="w"> </span>Port<span class="w"> </span>of<span class="w"> </span>grpc.<span class="w"> </span>Default<span class="w"> </span>is<span class="w"> </span><span class="m">50051</span>.<span class="w"> </span>If<span class="w"> </span>you<span class="w"> </span>deploy<span class="w"> </span>SolidityNode<span class="w"> </span>and<span class="w"> </span>FullNode<span class="w"> </span>on<span class="w"> </span>the<span class="w"> </span>same<span class="w"> </span>host，you<span class="w"> </span>need<span class="w"> </span>to<span class="w"> </span>configure<span class="w"> </span>different<span class="w"> </span>ports.
--commit<span class="w">  </span>Optional,<span class="w"> </span>commitid<span class="w"> </span>of<span class="w"> </span>project.
--branch<span class="w">  </span>Optional,<span class="w"> </span>branch<span class="w"> </span>of<span class="w"> </span>project.<span class="w">  </span>Mainnet<span class="w"> </span>default<span class="w"> </span>is<span class="w"> </span>latest<span class="w"> </span>release<span class="w"> </span>and<span class="w"> </span>Testnet<span class="w"> </span>default<span class="w"> </span>is<span class="w"> </span>master.
--heap-size<span class="w">  </span>Optional,<span class="w"> </span>jvm<span class="w"> </span>option:<span class="w"> </span>Xmx.<span class="w"> </span>The<span class="w"> </span>default<span class="w"> </span>heap-size<span class="w"> </span>is<span class="w"> </span><span class="m">0</span>.8<span class="w"> </span>*<span class="w"> </span>memory<span class="w"> </span>size.
--work_space<span class="w">  </span>Optional,<span class="w"> </span>default<span class="w"> </span>is<span class="w"> </span>current<span class="w"> </span>directory.
</code></pre></div>

<h3 id="fullnode_1">部署FullNode<a class="headerlink" href="#fullnode_1" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>wget<span class="w"> </span>https://raw.githubusercontent.com/tronprotocol/TronDeployment/master/deploy_tron.sh<span class="w"> </span>-O<span class="w"> </span>deploy_tron.sh
bash<span class="w"> </span>deploy_tron.sh
</code></pre></div>

<h3 id="soliditynode_1">部署SolidityNode<a class="headerlink" href="#soliditynode_1" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>wget<span class="w"> </span>https://raw.githubusercontent.com/tronprotocol/TronDeployment/master/deploy_tron.sh<span class="w"> </span>-O<span class="w"> </span>deploy_tron.sh
<span class="c1"># User can self-configure the IP and Port of GRPC service in the turst-node field of SolidityNode. trust-node is the fullnode you just deploy.</span>
bash<span class="w"> </span>deploy_tron.sh<span class="w"> </span>--app<span class="w"> </span>SolidityNode<span class="w"> </span>--trust-node<span class="w"> </span>&lt;grpc-ip:grpc-port&gt;
</code></pre></div>

<h3 id="fullnodesoliditynode">FullNode和SolidityNode部署在同一主机上<a class="headerlink" href="#fullnodesoliditynode" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># You need to configure different gRPC ports on the same host because gRPC port is available on SolidityNode and FullNodeConfigure and it cannot be set as default value 50051. In this case the default value of rpc port is set as 50041.</span>
wget<span class="w"> </span>https://raw.githubusercontent.com/tronprotocol/TronDeployment/master/deploy_tron.sh<span class="w"> </span>-O<span class="w"> </span>deploy_tron.sh
bash<span class="w"> </span>deploy_tron.sh<span class="w"> </span>--app<span class="w"> </span>FullNode
bash<span class="w"> </span>deploy_tron.sh<span class="w"> </span>--app<span class="w"> </span>SolidityNode<span class="w"> </span>--rpc-port<span class="w"> </span><span class="m">50041</span>
</code></pre></div>

<h2 id="grpc-gateway">Grpc Gateway部署<a class="headerlink" href="#grpc-gateway" title="Permanent link">&para;</a></h2>
<h3 id="_10">前提<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<p>请参照：<a href="https://github.com/tronprotocol/grpc-gateway">https://github.com/tronprotocol/grpc-gateway</a>
安装Golang, Protoc, 并且设置$GOPATH环境变量。</p>
<h3 id="_11">下载运行脚本<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>wget<span class="w"> </span>https://raw.githubusercontent.com/tronprotocol/TronDeployment/master/deploy_grpc_gateway.sh<span class="w"> </span>-O<span class="w"> </span>deploy_grpc_gateway.sh
</code></pre></div>

<h3 id="_12">参数含义<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>bash<span class="w"> </span>deploy_grpc_gateway.sh<span class="w"> </span>--rpchost<span class="w"> </span><span class="o">[</span>rpc<span class="w"> </span>host<span class="w"> </span>ip<span class="o">]</span><span class="w"> </span>--rpcport<span class="w"> </span><span class="o">[</span>rpc<span class="w"> </span>port<span class="w"> </span>number<span class="o">]</span><span class="w"> </span>--httpport<span class="w"> </span><span class="o">[</span>http<span class="w"> </span>port<span class="w"> </span>number<span class="o">]</span>

--rpchost<span class="w"> </span>The<span class="w"> </span>fullnode<span class="w"> </span>or<span class="w"> </span>soliditynode<span class="w"> </span>IP<span class="w"> </span>where<span class="w"> </span>the<span class="w"> </span>grpc<span class="w"> </span>service<span class="w"> </span>is<span class="w"> </span>provided.<span class="w"> </span>Default<span class="w"> </span>value<span class="w"> </span>is<span class="w"> </span><span class="s2">&quot;localhost&quot;</span>.
--rpcport<span class="w"> </span>The<span class="w"> </span>fullnode<span class="w"> </span>or<span class="w"> </span>soliditynode<span class="w"> </span>port<span class="w"> </span>number<span class="w"> </span>grpc<span class="w"> </span>service<span class="w"> </span>is<span class="w"> </span>consuming.<span class="w"> </span>Default<span class="w"> </span>value<span class="w"> </span>is<span class="w"> </span><span class="m">50051</span>.
--httpport<span class="w"> </span>The<span class="w"> </span>port<span class="w"> </span>intends<span class="w"> </span>to<span class="w"> </span>provide<span class="w"> </span>http<span class="w"> </span>service<span class="w"> </span>provided<span class="w"> </span>by<span class="w"> </span>grpc<span class="w"> </span>gateway.<span class="w"> </span>Default<span class="w"> </span>value<span class="w"> </span>is<span class="w"> </span><span class="m">18890</span>.
</code></pre></div>

<h3 id="_13">示例<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h3>
<p>使用默认配置：</p>
<div class="codehilite"><pre><span></span><code>bash<span class="w"> </span>deploy_grpc_gateway.sh
</code></pre></div>

<p>使用自定义配置：</p>
<div class="codehilite"><pre><span></span><code>bash<span class="w"> </span>deploy_grpc_gateway.sh<span class="w"> </span>--rpchost<span class="w"> </span><span class="m">127</span>.0.0.1<span class="w"> </span>--rpcport<span class="w"> </span><span class="m">50052</span><span class="w"> </span>--httpport<span class="w"> </span><span class="m">18891</span>
</code></pre></div>

<h2 id="_14">事件订阅部署<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>api</strong> 模块定义了介于java-tron与插件间的事件订阅接口。</li>
<li><strong>app</strong> 模块是加载插件示例，开发者可以用来调试。</li>
<li><strong>kafkaplugin</strong> 模块是kafka的实现。它实现了IPluginEventListener，它从java-tron接受事件并转给kafka服务。</li>
<li><strong>mongodbplugin</strong> 模块是mongodb的实现。</li>
</ul>
<h3 id="_15">搭建运行环境<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h3>
<ol>
<li>Clone the repo <code>git clone https://github.com/tronprotocol/event-plugin.git</code></li>
<li>Go to eventplugin <code>cd event-plugin</code></li>
<li>
<p>run <code>./gradlew build</code></p>
</li>
<li>
<p>这一步会生成<code>plugin-kafka-1.0.0.zip</code>，位于<code>event-plugin/build/plugins/</code>目录下。</p>
</li>
</ol>
<h3 id="java-tron-configconf">编辑java-tron的 <strong>config.conf</strong> 文件，增加以下字段<a class="headerlink" href="#java-tron-configconf" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="nx">event</span><span class="p">.</span><span class="nx">subscribe</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">path</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="c1">// absolute path of plugin</span>
<span class="w">    </span><span class="nx">server</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="c1">// target server address to receive event triggers</span>
<span class="w">    </span><span class="nx">dbconfig</span><span class="p">=</span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="c1">// dbname|username|password</span>
<span class="w">    </span><span class="nx">topics</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nx">triggerName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;block&quot;</span><span class="w"> </span><span class="c1">// block trigger, the value can&#39;t be modified</span>
<span class="w">          </span><span class="nx">enable</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">          </span><span class="nx">topic</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;block&quot;</span><span class="w"> </span><span class="c1">// plugin topic, the value could be modified</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nx">triggerName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;transaction&quot;</span>
<span class="w">          </span><span class="nx">enable</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">          </span><span class="nx">topic</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;transaction&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nx">triggerName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;contractevent&quot;</span>
<span class="w">          </span><span class="nx">enable</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">          </span><span class="nx">topic</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;contractevent&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nx">triggerName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;contractlog&quot;</span>
<span class="w">          </span><span class="nx">enable</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">          </span><span class="nx">topic</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;contractlog&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>

<span class="w">    </span><span class="nx">filter</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">       </span><span class="nx">fromblock</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="c1">// the value could be &quot;&quot;, &quot;earliest&quot; or a specified block number as the beginning of the queried range</span>
<span class="w">       </span><span class="nx">toblock</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="c1">// the value could be &quot;&quot;, &quot;latest&quot; or a specified block number as end of the queried range</span>
<span class="w">       </span><span class="nx">contractAddress</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">           </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="c1">// contract address you want to subscribe, if it&#39;s set to &quot;&quot;, you will receive contract logs/events with any contract address.</span>
<span class="w">       </span><span class="p">]</span>

<span class="w">       </span><span class="nx">contractTopic</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">           </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="c1">// contract topic you want to subscribe, if it&#39;s set to &quot;&quot;, you will receive contract logs/events with any contract topic.</span>
<span class="w">       </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong><em>path</em>*: "plugin-kafka-1.0.0.zip"文件的绝对路径
 </strong><em>server</em><em>: Kafka服务地址
 </em><strong>topics</strong>: 每一种事件匹配一个Kafka主题，我们支持四种事件订阅：区块事件，交易事件，合约事件以及合约日志事件
 <strong><em>dbconfig</em>*: mongodb的配置，dbname|username|password。如果使用kafka，可以忽略这个参数。
 </strong><em>triggerName</em><em>: 触发类型，只读。
 </em><strong>enable</strong>: 是否开启事件订阅。
 <strong><em>topic</em>*: kafka接收事件的主题。请确保Kafka在运行中。
 </strong><em>filter</em><em>: 事件订阅过滤选项。
 </em><em>注意</em>*: 如果服务器地址不是127.0.0.1, 请在config/server.properties文件中设置listeners=PLAINTEXT://:9092，advertised.listeners to PLAINTEXT://host_ip:9092</p>
<h3 id="kafka">安装Kafka<a class="headerlink" href="#kafka" title="Permanent link">&para;</a></h3>
<p><strong>Mac环境</strong>:</p>
<div class="codehilite"><pre><span></span><code>brew<span class="w"> </span>install<span class="w"> </span>kafka
</code></pre></div>

<p><strong>Linux环境</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/usr/local
wget<span class="w"> </span>http://archive.apache.org/dist/kafka/0.10.2.2/kafka_2.10-0.10.2.2.tgz
tar<span class="w"> </span>-xzvf<span class="w"> </span>kafka_2.10-0.10.2.2.tgz
mv<span class="w"> </span>kafka_2.10-0.10.2.2<span class="w"> </span>kafka

add<span class="w"> </span><span class="s2">&quot;export PATH=</span><span class="nv">$PATH</span><span class="s2">:/usr/local/kafka/bin&quot;</span><span class="w"> </span>to<span class="w"> </span>end<span class="w"> </span>of<span class="w"> </span>/etc/profile
<span class="nb">source</span><span class="w"> </span>/etc/profile


kafka-server-start.sh<span class="w"> </span>/usr/local/kafka/config/server.properties<span class="w"> </span><span class="p">&amp;</span>
</code></pre></div>

<p><strong>注意</strong>: 请确保Kafka的版本与build.gradle中eventplugin项目的版本一致。</p>
<h3 id="kafka_1">运行Kafka<a class="headerlink" href="#kafka_1" title="Permanent link">&para;</a></h3>
<p><strong>Mac环境</strong>:</p>
<div class="codehilite"><pre><span></span><code>zookeeper-server-start<span class="w"> </span>/usr/local/etc/kafka/zookeeper.properties<span class="w"> </span><span class="p">&amp;</span><span class="w"> </span>kafka-server-start<span class="w"> </span>/usr/local/etc/kafka/server.properties
</code></pre></div>

<p><strong>Linux环境</strong>:</p>
<div class="codehilite"><pre><span></span><code>zookeeper-server-start.sh<span class="w"> </span>/usr/local/kafka/config/zookeeper.properties<span class="w"> </span><span class="p">&amp;</span>
Sleep<span class="w"> </span>about<span class="w"> </span><span class="m">3</span><span class="w"> </span>seconds
kafka-server-start.sh<span class="w"> </span>/usr/local/kafka/config/server.properties<span class="w"> </span><span class="p">&amp;</span>
</code></pre></div>

<h3 id="configconf">创建主题接受事件，主题的定义位于config.conf文件中<a class="headerlink" href="#configconf" title="Permanent link">&para;</a></h3>
<p><strong>Mac环境</strong>:</p>
<div class="codehilite"><pre><span></span><code>kafka-topics<span class="w"> </span>--create<span class="w"> </span>--zookeeper<span class="w"> </span>localhost:2181<span class="w"> </span>--replication-factor<span class="w"> </span><span class="m">1</span><span class="w"> </span>--partitions<span class="w"> </span><span class="m">1</span><span class="w"> </span>--topic<span class="w"> </span>block
kafka-topics<span class="w"> </span>--create<span class="w"> </span>--zookeeper<span class="w"> </span>localhost:2181<span class="w"> </span>--replication-factor<span class="w"> </span><span class="m">1</span><span class="w"> </span>--partitions<span class="w"> </span><span class="m">1</span><span class="w"> </span>--topic<span class="w"> </span>transaction
kafka-topics<span class="w"> </span>--create<span class="w"> </span>--zookeeper<span class="w"> </span>localhost:2181<span class="w"> </span>--replication-factor<span class="w"> </span><span class="m">1</span><span class="w"> </span>--partitions<span class="w"> </span><span class="m">1</span><span class="w"> </span>--topic<span class="w"> </span>contractlog
kafka-topics<span class="w"> </span>--create<span class="w"> </span>--zookeeper<span class="w"> </span>localhost:2181<span class="w"> </span>--replication-factor<span class="w"> </span><span class="m">1</span><span class="w"> </span>--partitions<span class="w"> </span><span class="m">1</span><span class="w"> </span>--topic<span class="w"> </span>contractevent
</code></pre></div>

<p><strong>Linux环境</strong>:</p>
<div class="codehilite"><pre><span></span><code>kafka-topics.sh<span class="w">  </span>--create<span class="w"> </span>--zookeeper<span class="w"> </span>localhost:2181<span class="w"> </span>--replication-factor<span class="w"> </span><span class="m">1</span><span class="w"> </span>--partitions<span class="w"> </span><span class="m">1</span><span class="w"> </span>--topic<span class="w"> </span>block
kafka-topics.sh<span class="w"> </span>--create<span class="w"> </span>--zookeeper<span class="w"> </span>localhost:2181<span class="w"> </span>--replication-factor<span class="w"> </span><span class="m">1</span><span class="w"> </span>--partitions<span class="w"> </span><span class="m">1</span><span class="w"> </span>--topic<span class="w"> </span>transaction
kafka-topics.sh<span class="w"> </span>--create<span class="w"> </span>--zookeeper<span class="w"> </span>localhost:2181<span class="w"> </span>--replication-factor<span class="w"> </span><span class="m">1</span><span class="w"> </span>--partitions<span class="w"> </span><span class="m">1</span><span class="w"> </span>--topic<span class="w"> </span>contractlog
kafka-topics.sh<span class="w"> </span>--create<span class="w"> </span>--zookeeper<span class="w"> </span>localhost:2181<span class="w"> </span>--replication-factor<span class="w"> </span><span class="m">1</span><span class="w"> </span>--partitions<span class="w"> </span><span class="m">1</span><span class="w"> </span>--topic<span class="w"> </span>contractevent
</code></pre></div>

<h3 id="kafka_2">Kafka用户<a class="headerlink" href="#kafka_2" title="Permanent link">&para;</a></h3>
<p><strong>Mac环境</strong>:</p>
<div class="codehilite"><pre><span></span><code>kafka-console-consumer<span class="w"> </span>--bootstrap-server<span class="w"> </span>localhost:9092<span class="w">  </span>--topic<span class="w"> </span>block
kafka-console-consumer<span class="w"> </span>--bootstrap-server<span class="w"> </span>localhost:9092<span class="w">  </span>--topic<span class="w"> </span>transaction
kafka-console-consumer<span class="w"> </span>--bootstrap-server<span class="w"> </span>localhost:9092<span class="w">  </span>--topic<span class="w"> </span>contractlog
kafka-console-consumer<span class="w"> </span>--bootstrap-server<span class="w"> </span>localhost:9092<span class="w">  </span>--topic<span class="w"> </span>contractevent
</code></pre></div>

<p><strong>Linux环境</strong>:</p>
<div class="codehilite"><pre><span></span><code>kafka-console-consumer.sh<span class="w"> </span>--zookeeper<span class="w"> </span>localhost:2181<span class="w"> </span>--topic<span class="w"> </span>block
kafka-console-consumer.sh<span class="w"> </span>--zookeeper<span class="w"> </span>localhost:2181<span class="w"> </span>--topic<span class="w"> </span>transaction
kafka-console-consumer.sh<span class="w"> </span>--zookeeper<span class="w"> </span>localhost:2181<span class="w"> </span>--topic<span class="w"> </span>contractlog
kafka-console-consumer.sh<span class="w"> </span>--zookeeper<span class="w"> </span>localhost:2181<span class="w"> </span>--topic<span class="w"> </span>contractevent
</code></pre></div>

<h3 id="java-tron">在java-tron中加载插件<a class="headerlink" href="#java-tron" title="Permanent link">&para;</a></h3>
<ul>
<li>add --es to command line, for example:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="w"> </span>java<span class="w"> </span>-jar<span class="w"> </span>FullNode.jar<span class="w"> </span>-p<span class="w"> </span>privatekey<span class="w"> </span>-c<span class="w"> </span>config.conf<span class="w"> </span>--es
</code></pre></div>

<h3 id="_16">事件订阅过滤<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h3>
<p>事件订阅过滤参数在config.conf文件中设置：</p>
<div class="codehilite"><pre><span></span><code><span class="nx">filter</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">       </span><span class="nx">fromblock</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="c1">// the value could be &quot;&quot;, &quot;earliest&quot; or a specified block number as the beginning of the queried range</span>
<span class="w">       </span><span class="nx">toblock</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="c1">// the value could be &quot;&quot;, &quot;latest&quot; or a specified block number as end of the queried range</span>
<span class="w">       </span><span class="nx">contractAddress</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">           </span><span class="s">&quot;TVkNuE1BYxECWq85d8UR9zsv6WppBns9iH&quot;</span><span class="w"> </span><span class="c1">// contract address you want to subscribe, if it&#39;s set to &quot;&quot;, you will receive contract logs/events with any contract address.</span>
<span class="w">       </span><span class="p">]</span>

<span class="w">       </span><span class="nx">contractTopic</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">           </span><span class="s">&quot;f0f1e23ddce8a520eaa7502e02fa767cb24152e9a86a4bf02529637c4e57504b&quot;</span><span class="w"> </span><span class="c1">// contract topic you want to subscribe, if it&#39;s set to &quot;&quot;, you will receive contract logs/events with any contract topic.</span>
<span class="w">       </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>

<h3 id="mongodb">下载并安装MongoDB<a class="headerlink" href="#mongodb" title="Permanent link">&para;</a></h3>
<h4 id="_17">建议配置<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h4>
<ul>
<li>CPU/ RAM: 16Core / 32G</li>
<li>DISK: 500G</li>
<li>System: CentOS 64</li>
</ul>
<p>MongoDB的版本是<strong>4.0.4</strong>，以下是安装命令:</p>
<ul>
<li>cd /home/java-tron</li>
<li>curl -O https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-4.0.4.tgz</li>
<li>tar zxvf mongodb-linux-x86_64-4.0.4.tgz</li>
<li>mv mongodb-linux-x86_64-4.0.4 mongodb</li>
</ul>
<h4 id="_18">设计环境变量<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h4>
<ul>
<li>export MONGOPATH=/home/java-tron/mongodb/</li>
<li>export PATH=$PATH:$MONGOPATH/bin</li>
</ul>
<h4 id="_19">创建配置文件<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h4>
<p>The path is : /etc/mongodb/mgdb.conf</p>
<ul>
<li>cd /etc/mongodb</li>
<li>touch mgdb.conf</li>
</ul>
<p>创建数据和日志文件夹，并把它们的绝对路径加入mgdb.conf</p>
<h4 id="_20">示例<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h4>
<ul>
<li>dbpath=/home/java-tron/mongodb/data</li>
<li>logpath=/home/java-tron/mongodb/log/mongodb.log</li>
<li>port=27017</li>
<li>logappend=true</li>
<li>fork=true</li>
<li>bind_ip=0.0.0.0</li>
<li>auth=true</li>
<li>wiredTigerCacheSizeGB=2</li>
</ul>
<h4 id="_21">注意<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h4>
<ul>
<li>bind_ip must be configured to 0.0.0.0，otherwise remote connection will be refused.</li>
<li>wiredTigerCacheSizeGB, must be configured to prevent OOM</li>
</ul>
<h4 id="mongodb_1">运行MongoDB<a class="headerlink" href="#mongodb_1" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code>mongod<span class="w">  </span>--config<span class="w"> </span>/etc/mongodb/mgdb.conf
</code></pre></div>

<h4 id="_22">创建管理员账户<a class="headerlink" href="#_22" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code>-<span class="w"> </span>mongo
-<span class="w"> </span>use<span class="w"> </span>admin
-<span class="w"> </span>db.createUser<span class="o">({</span>user:<span class="s2">&quot;root&quot;</span>,pwd:<span class="s2">&quot;admin&quot;</span>,roles:<span class="o">[{</span>role:<span class="s2">&quot;root&quot;</span>,db:<span class="s2">&quot;admin&quot;</span><span class="o">}]})</span>
</code></pre></div>

<h4 id="_23">创建事件日志以及所有者账户<a class="headerlink" href="#_23" title="Permanent link">&para;</a></h4>
<ul>
<li>db.auth("root", "admin")</li>
<li>use eventlog</li>
<li>db.createUser({user:"tron",pwd:"123456",roles:[{role:"dbOwner",db:"eventlog"}]})</li>
</ul>
<blockquote>
<p>database: eventlog, username:tron, password: 123456</p>
</blockquote>
<h4 id="_24">防火墙策略<a class="headerlink" href="#_24" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="w"> </span>NEW<span class="w"> </span>-m<span class="w"> </span>tcp<span class="w"> </span>--dport<span class="w"> </span><span class="m">27017</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
</code></pre></div>

<h4 id="mongo">远程连接mongo<a class="headerlink" href="#mongo" title="Permanent link">&para;</a></h4>
<ul>
<li>mongo 47.90.245.68:27017</li>
<li>use eventlog</li>
<li>db.auth("tron", "123456")</li>
<li>show collections</li>
<li>db.block.find()</li>
</ul>
<h4 id="_25">查询区块事件触发数据<a class="headerlink" href="#_25" title="Permanent link">&para;</a></h4>
<ul>
<li>db.block.find({blockNumber: {$lt: 1000}});  // 返回区块高度小于1000的数据</li>
</ul>
<h4 id="_26">设置数据库索引<a class="headerlink" href="#_26" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/<span class="o">{</span>projectPath<span class="o">}</span>
sh<span class="w"> </span>insertIndex.sh
</code></pre></div>

<h2 id="_27">事件订阅数据查询服务部署<a class="headerlink" href="#_27" title="Permanent link">&para;</a></h2>
<h3 id="_28">下载代码<a class="headerlink" href="#_28" title="Permanent link">&para;</a></h3>
<p>git clone https://github.com/tronprotocol/tron-eventquery.git
cd troneventquery</p>
<h3 id="_29">编译<a class="headerlink" href="#_29" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>mvn<span class="w"> </span>package
</code></pre></div>

<p>代码编译成功后，在/troneventquery目录下会生成troneventquery.jar文件。</p>
<p>需要创建一个config.conf配置文件用来设置mongodb的配置属性，我们在/troneventquery/config.conf中提供了个示例，如果有需要可以进行修改。</p>
<p><strong>注意：</strong></p>
<p>config.conf文件应该位于/troneventquery文件夹下。</p>
<ul>
<li>mongo.host=IP</li>
<li>mongo.port=27017</li>
<li>mongo.dbname=eventlog</li>
<li>mongo.username=tron</li>
<li>mongo.password=123456</li>
<li>mongo.connectionsPerHost=8</li>
<li>mongo.threadsAllowedToBlockForConnectionMultiplier=4</li>
</ul>
<p><strong>mongo.dbname</strong>的值是指定的事件订阅数据库的名称，不可以修改。</p>
<h3 id="_30">运行<a class="headerlink" href="#_30" title="Permanent link">&para;</a></h3>
<ul>
<li>troneventquery/deploy.sh 是用来部署事件订阅数据查询服务的。</li>
<li>troneventquery/insertIndex.sh 是用来设置mongodb索引来加速查询的。</li>
</ul>
<h2 id="_31">高级配置<a class="headerlink" href="#_31" title="Permanent link">&para;</a></h2>
<p>Read the <a href="../advanced-configuration/">Advanced Configuration</a></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tracing", "navigation.expand", "navigation.tabs"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>