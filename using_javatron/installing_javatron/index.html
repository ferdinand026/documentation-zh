<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://tronprotocol.github.io/documentation-zh/using_javatron/installing_javatron/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>部署 - java-tron</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "\u90e8\u7f72";
        var mkdocs_page_input_path = "using_javatron/installing_javatron.md";
        var mkdocs_page_url = "/documentation-zh/using_javatron/installing_javatron/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> java-tron
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">java-tron入门</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../getting_started/getting_started_with_javatron/">入门</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">使用java-tron</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">部署</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#_1">编译源码</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#java-tron_1">启动java-tron节点</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#_2">启动全节点</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_3">启动出块的全节点</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_4">其它说明</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#keystore">如何使用keystore+密码的方式指定超级代表账户私钥</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#tcmalloc">使用tcmalloc优化内存占用</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../backup_restore/">备份和恢复</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../litefullnode/">轻节点</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../private_network/">私链网络</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../architecture/event/">事件订阅</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../architecture/database/">数据库配置</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../connecting_to_tron/">网络连接</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../metrics/">节点监控</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../toolkit/">节点维护工具</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API接口</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/http/">HTTP 接口</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/rpc/">gRPC 接口</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/json-rpc/">jsonRPC 接口</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">核心协议</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../mechanism-algorithm/dpos/">波场共识</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../mechanism-algorithm/sr/">超级代表</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../mechanism-algorithm/account/">账户模型</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../mechanism-algorithm/resource/">资源模型</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../contracts/contract/">智能合约</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../mechanism-algorithm/system-contracts/">系统合约</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../mechanism-algorithm/dex/">去中心化交易所</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../mechanism-algorithm/multi-signatures/">账户权限管理</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">java-tron开发</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../developers/java-tron/">开发者指南</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developers/tips/">TIPs工作流程</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developers/issue-workflow/">Issue工作流程</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developers/governance/">治理流程</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developers/run-in-idea/">配置IDE开发环境</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developers/demo/">开发示例</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developers/code-structure/">核心模块</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Dapp开发</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../contracts/tools/">工具</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">客户端</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../clients/wallet-cli/">wallet-cli</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">版本发布</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../releases/upgrade-instruction/">新版本部署手册</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../releases/signature_verification/">一致性检验</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../releases/history/">历史版本</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">附录</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../glossary/">术语表</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">java-tron</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">使用java-tron</li>
      <li class="breadcrumb-item active">部署</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/tronprotocol/documentation-zh/edit/master/docs/using_javatron/installing_javatron.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="java-tron">部署java-tron节点<a class="headerlink" href="#java-tron" title="Permanent link">&para;</a></h1>
<p>java-tron节点支持部署在 <code>Linux</code> 或 <code>MacOS</code> 操作系统上，并且依赖<code>Oracle JDK 1.8</code> ，不支持其它版本的JDK。</p>
<p>运行java-tron节点需要的最小的硬件配置是 <code>8核CPU</code>、<code>16G内存</code>、<code>3T SDD</code>，推荐的配置是： <code>16核CPU</code>、<code>32G内存</code>、<code>3.5T+ SDD</code>，超级代表产块节点建议 <code>32核CPU</code>、<code>64G内存</code>。</p>
<h2 id="_1">编译源码<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>首先，通过如下git命令将java-tron源代码克隆到本地，并且切换到master分支。在执行命令前，请确保已经安装了<code>git</code>工具。</p>
<div class="highlight"><pre><span></span><code>$ git clone https://github.com/tronprotocol/java-tron.git
$ git checkout -t origin/master
</code></pre></div>
<p>然后，通过执行如下命令编译java-tron源代码。参数<code>-x test</code>表示跳过执行测试用例，您也可以去掉这个参数，以在编译的过程中执行测试代码，这将使编译时间更长。编译完成之后，FullNode.jar会生成在 <code>java-tron/build/libs/</code>目录下。</p>
<div class="highlight"><pre><span></span><code>$ cd java-tron
$ ./gradlew clean build -x test
</code></pre></div>
<h2 id="java-tron_1">启动java-tron节点<a class="headerlink" href="#java-tron_1" title="Permanent link">&para;</a></h2>
<p>你可以选择不同的配置文件将java-tron节点连接到不同的网络中，其中主网全节点配置文件为：<a href="https://github.com/tronprotocol/tron-deployment/blob/master/main_net_config.conf">main_net_config.conf</a>，其它网络节点配置文件在<a href="https://github.com/tronprotocol/tron-deployment">这里</a>下载。</p>
<h3 id="_2">启动全节点<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p>Fullnode作为TRON网络的入口点，拥有完整的历史数据，并提供对外访问的HTTP API和GRPC API。您可以通过全节点与TRON网络进行交互，如：资产转移、合约部署、合约交互等。主网全节点启动命令如下，并通过<code>-c</code>参数指定全节点的配置文件。下面启动命令中使用的是主网的配置文件，因此启动的是一个主网的全节点，启动Nile测试网的全节点或者私链的全节点，请使用对应的配置文件：</p>
<div class="highlight"><pre><span></span><code>$  java -Xmx24g -XX:+UseConcMarkSweepGC -jar FullNode.jar -c main_net_config.conf
</code></pre></div>
<ul>
<li>-XX:+UseConcMarkSweepGC  ：指定并行垃圾回收。要放在 -jar 参数前面，不能放在最后面。</li>
<li>-Xmx  ：JVM堆的最大值，可以设置成物理内存的80%。</li>
</ul>
<h3 id="_3">启动出块的全节点<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>将<code>--witness</code>参数添加到启动命令中，fullnode将作为出块的全节点运行。出块全节点除了支持fullnode的所有功能，它还支持区块生产和交易打包。请确保您拥有一个超级代表账户，并获得他人的投票，如果票数排在前27名，您需要启动一个出块的全节点参与区块生产。</p>
<p>将超级代表地址的私钥填写到main_net_config.conf的localwitness列表中，示例如下。但如果不希望使用这种以明文的方式进行私钥指定，可以使用keystore + 密码的方式，请参考<a href="#_2">其它说明</a></p>
<div class="highlight"><pre><span></span><code>localwitness = [
    650950B193DDDDB35B6E48912DD28F7AB0E7140C1BFDEFD493348F02295BD812
]
</code></pre></div>
<p>然后执行如下命令来启动节点:</p>
<div class="highlight"><pre><span></span><code>$ java -Xmx24g -XX:+UseConcMarkSweepGC -jar FullNode.jar --witness -c main_net_config.conf
</code></pre></div>
<p><strong>注意</strong>：对于主网和nile测试网，由于新节点启动后，需要同步的数据量较大，因此同步数据需要较长的时间。可以使用 <a href="../backup_restore/#_5">数据快照</a> 来加快节点同步速度。首先下载最新的数据快照，并将其解压至tron项目的output-directory目录下，然后再启动节点，这样节点将在数据快照的基础上进行同步。</p>
<h3 id="_4">其它说明<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<h4 id="keystore">如何使用keystore+密码的方式指定超级代表账户私钥<a class="headerlink" href="#keystore" title="Permanent link">&para;</a></h4>
<ol>
<li>这种方式指定私钥，需要在启动节点时进行人机交互，因此请不要使用nohup命令，建议使用会话保持工具，如screen, tmux等。</li>
<li>注释掉节点配置文件中的localwitness配置项，取消localwitnesskeystore配置项的注释，填入keystore文件的路径，注意keystore文件需要放到启动命令执行的当前目录下或者其子目录下。如当前目录是A，keystore文件的目录是A/B/localwitnesskeystore.json，则需要配置成：
    <div class="highlight"><pre><span></span><code>localwitnesskeystore = [
      &quot;B/localwitnesskeystore.json&quot;
]
</code></pre></div>
    注：可以使用<a href="https://github.com/tronprotocol/wallet-cli.git">wallet-cli</a>项目的registerwallet命令生成 keystore + 密码。</li>
<li>启动出块的全节点
    <div class="highlight"><pre><span></span><code>  $ java -Xmx24g -XX:+UseConcMarkSweepGC -jar FullNode.jar --witness -c main_net_config.conf
</code></pre></div></li>
<li>正确的输入密码，完成节点启动。</li>
</ol>
<h4 id="tcmalloc">使用tcmalloc优化内存占用<a class="headerlink" href="#tcmalloc" title="Permanent link">&para;</a></h4>
<p>为达到内存使用最优化，可以使用 google tcmalloc 替代系统 glibc malloc. 方法如下：
安装tcmalloc，然后在启动脚本中添加以下两行，不同的linux发行版tcmalloc的路径略有差异。
<div class="highlight"><pre><span></span><code>#!/bin/bash

export LD_PRELOAD=&quot;/usr/lib/libtcmalloc.so.4&quot;
export TCMALLOC_RELEASE_RATE=10

# original start command
java -jar .....
</code></pre></div></p>
<p>在各个linux发行版上安装命令如下：</p>
<ul>
<li>
<p>Ubuntu 20.04 LTS / Ubuntu 18.04 LTS / Debian stable
    安装</p>
<div class="highlight"><pre><span></span><code>sudo apt install libgoogle-perftools4
</code></pre></div>
<p>在启动脚本中添加：</p>
<div class="highlight"><pre><span></span><code>export LD_PRELOAD=&quot;/usr/lib/x86_64-linux-gnu/libtcmalloc.so.4&quot;
export TCMALLOC_RELEASE_RATE=10
</code></pre></div>
</li>
<li>
<p>Ubuntu 16.04 LTS
    安装同上，在启动脚本中添加：</p>
<div class="highlight"><pre><span></span><code>export LD_PRELOAD=&quot;/usr/lib/libtcmalloc.so.4&quot;
export TCMALLOC_RELEASE_RATE=10
</code></pre></div>
</li>
<li>
<p>CentOS 7
  安装
    <div class="highlight"><pre><span></span><code>sudo yum install gperftools-libs
</code></pre></div>
    在启动脚本中添加：
    <div class="highlight"><pre><span></span><code>export LD_PRELOAD=&quot;/usr/lib64/libtcmalloc.so.4&quot;
export TCMALLOC_RELEASE_RATE=10
</code></pre></div></p>
</li>
</ul>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../../getting_started/getting_started_with_javatron/" class="btn btn-neutral float-left" title="入门"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../backup_restore/" class="btn btn-neutral float-right" title="备份和恢复">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/tronprotocol/documentation-zh" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../../getting_started/getting_started_with_javatron/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../backup_restore/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
